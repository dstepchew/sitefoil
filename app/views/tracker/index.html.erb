'use strict';
console.log("sitefoil tracker.js script started, site_id: "+<%= @site.id rescue 'not defined' %>)
var hit_id = "<%= @hit.id %>"


var xhr = new XMLHttpRequest()
var url = "http://<%= request.host_with_port%>/tracker/data_from_script?hit_id="+hit_id+
          "&hit[referrer]="+encodeURIComponent(document.referrer)
xhr.open('GET', url);
xhr.onreadystatechange = function (data) {
  if(xhr.readyState==4) {
    console.log(xhr.responseText)
  }
}
xhr.send();


window.onload = function() {

	<% @site.recipes_list.split("\n").each do |recipe| %>
		<% continue if recipe.blank? %>
		<%= "// recipe: #{recipe}\n".html_safe %>
		try {
			<% begin %>
				<%= eval("@site.recipe_#{recipe}").html_safe %>
			<% rescue %>
				<%= "// error! while trying to build recipe code: #{recipe}".html_safe %>
			<% end %>
		} catch (err) {
		  console.log("error while running recipe: <%= recipe %>")
		}
	<% end %>

}