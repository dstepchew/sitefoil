<script src=/bower_components/underscore/underscore-min.js></script>
<script src=/bower_components/underscore.string/dist/underscore.string.min.js></script>
<%= javascript_include_tag "recipe_wizard" %>
<style>
#recipe_wizard, #recipe_wizard input, #recipe_wizard select {
	font-size: 25px !important; margin: 10px 0;
}

#recipe_wizard textarea {
	width: 100%;
	line-height: 25px;
	height: 120px;
}

select, input[type=text], input[type=date], input[type=time], #recipe { 
	border:0; color:#000000; background: #fff;
	font-size:20px; font-weight:bold; padding:2px 10px; 
 *background:#FFFFFF; -webkit-appearance: none; 
}

</style>


<% ApplicationHelper::triggers.each do |condition| %>
	<div class='condition_methods' data-condition-name='<%= condition[:name] %>' style='display:none'>
	  <option value=''>-- select method -- </option>
		<% condition[:methods].each do |method| %>
		  <option value='<%= method %>'><%= ApplicationHelper::human_method(method) %></option>
		<% end %>
	</div>
<% end %>

<div id=condition_template style='display:none'>
  <div class=condition>
	
		if 

		<select id=condition_name onchange='onConditionChange.apply(this)' style='font-size:40px'>
			<option value=''>-- select variable -- </option>
			<% ApplicationHelper::triggers.sort_by{ |r| r[:name]}.each do |condition| %>
			  <option value='<%= condition[:name] %>' data-js='<%= condition[:js] %>'><%= condition[:name] %></option>
			<% end %>
		</select>

		<select id=condition_method style='display:none' onchange='onConditionMethodChange.apply(this)'>
		</select>

		<span id=condition_param_wrap>
		</span>

		<select id=logic onchange='onLogicChange.apply(this)' style='display:none'>
				<option value=''></option>
				<option value='&&'>and</option>
		</select>
	</div>

</div>

<div style='display:none'>

	<% ApplicationHelper::triggers.each do |condition| %>
	<div class=condition_param_template data-condition-name='<%= condition[:name] %>'>
		<% if condition[:possible_values] %>
			<select id=condition_param>
				<% condition[:possible_values].each do |val| %>
					<% if val.class == Array %>
						<option value='<%= val[0] %>'><%= val[1] %></option>
					<% else %>
						<option value='<%= val %>'><%= val %></option>
					<% end %>
				<% end %>
			</select>
		<% else %>
			<% if condition[:input_type] == :selector_pick %>
				<input id=condition_param>
				<input type=button value='...' style='margin-left:-35px' 	class='selector_pick'>
			<% else %>
				<input id=condition_param
					<% if condition[:input_type] %>
					type=<%= condition[:input_type].to_s %>
					<% end %>
				>
			<% end %>
		<% end %>
	</div>
	<% end %>

</div>


<div id=recipe_wizard style='font-size:40px'>


	<div id=conditions>

	</div>

	then

	<select id=action onchange='onActionChange()'>
		<option value=''>-- select action -- </option>
		<% ApplicationHelper::actions.sort_by{ |r| r[:name]}.each do |action| %>
			<option data-js='<%= action[:js] %>' value='<%= action[:name] %>'><%= action[:name] %></option>
		<% end %>
	</select>

  <span id=action_params>
  </span>

	<% ApplicationHelper::actions.each do |action| %>
		<div class='action_params' data-action-name='<%= action[:name] %>' style='display:none'>
			<% action[:params].each do |param| %>
				<% param_name = (param[:name] rescue param) %>
				<% if (param[:input_type] rescue false) == :selector_pick %>
					<%= (param[:caption] || param_name) rescue param_name %>:
					<input class='action_param' name=<%= param_name %>>
					<input type=button value='...' style='margin-left:-35px' 	class='selector_pick'>
				<% elsif (param[:input_type] rescue false) == :textarea %>
					<br><%= (param[:caption] || param_name) rescue param_name %>:<br>
					<textarea class=action_param name=<%= param_name %>></textarea>
				<% else %>
					<%= param_name %>: <input class=action_param name=<%= param_name %>>
				<% end %>
			<% end %>
		</div>
	<% end %>

</div>