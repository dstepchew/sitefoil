<style>

#site option {
	font-size: 14px;
}

a {
	cursor: pointer;
}
.step {
	border-top: 1px solid black;
}

.wizard-progress {
	font-size: 14px;
	text-align: right;
}

.trigger, .action {
	cursor: pointer;
}

.step {
	display:none;
}

ul.steps {
	list-style: none;
}

.trigger_settings {
	display: none;
}

.back {
	display: none;
}

</style>

<script>

function toStep(step_name) {

	console && console.log("to step: "+step_name)
	$(".step").css({opacity: 0.5}) //hide all

	$(".back").hide() //hide all

	$(".step."+step_name).find(".back").show() //show back button in new step

	$(".step."+step_name).show()
		.animate({opacity: 1}, 500);

  $('html, body').animate({
      scrollTop: $(".step."+step_name).offset().top
  }, 500);

}

function toTriggerParams(trigger_name) {
	toStep("trigger_params");
	$(".step.trigger_params .trigger_name").html(trigger_name)
	$(".step.trigger_params .trigger_settings").hide()
	$(".step.trigger_params .trigger_settings[data-trigger-name='"+trigger_name+"']").show();
}

function toActionParams(action_name) {
	toStep("action_params");

	$(".step.action_params .action_name").html(action_name);


  $(".step.action_params .action_params").hide();
  $(".step.action_params .action_params[data-action-name='"+action_name+"']").show()
}


function back() {
  $(this).parents(".step").hide();
  $(this).parents(".step").prev().show().animate({opacity: 1}, 500);
  $(this).parents(".step").prev().find(".back").show();

  $('html, body').animate({
      scrollTop: $(this).parents(".step").prev().offset().top
  }, 500);
}

var trigger_num = 1;

function anotherTrigger() {
	trigger_num++;
	$(this).parents(".step").after($(".step.action_or_another_trigger")[0].outerHTML)
	$(this).parents(".step").after($(".step.trigger_params")[0].outerHTML)
	$(this).parents(".step").after($(".step.trigger")[0].outerHTML)

	$(".step.trigger").last().hide().removeClass("trigger").addClass("trigger_"+trigger_num)
	$(".step.trigger_params").last().hide().removeClass("trigger_params").addClass("trigger_params_"+trigger_num)
	$(".step.action_or_another_trigger").last().hide().removeClass("action_or_another_trigger").addClass("action_or_another_trigger_"+trigger_num)

	$(".step.trigger_"+trigger_num+" .trigger").attr("onclick",'toStep("trigger_params_'+trigger_num+'")')
	$(".step.trigger_params_"+trigger_num+" .done").attr("onclick",'toStep("action_or_another_trigger_'+trigger_num+'")')

	toStep("trigger_"+trigger_num)

}

$(function() {
	$(".step.site_select").show();

	$("a.back").click(function() {
		back.apply(this);
	})

})

</script>

<ul class="steps" id=recipe_animated>
	<li class='step site_select' style='border-top:none;font-size:40px;'>
		Select site:
		<select id=site onChange='toStep("start")'>
			<% current_user.sites.each do |site| %>
				<option value=''>--select site--</option>
				<option value=<%= site.id%>><%= site.name_or_url %></option>
			<% end %>
		</select>
		or <a href=#>add site</a>
	</li>

	<li class='step start'>
		<div class='wizard-progress'><a onclick='$("#site").val("")' class='back'>back</a></div>
		<h1>if <a onclick='toStep("trigger")'>this</a> then that</h1>
	</li>

	<li class='step trigger'>
		<div class='wizard-progress'><a class='back'>back</a> </div>
		<h1>Choose Trigger</h1>
		<div style='font-size:20px'>
			<% ApplicationHelper::triggers.each do |trigger| %>
				<div class="trigger_select" onclick='toTriggerParams("<%= trigger[:name] %>")'><%= trigger[:name] %></div>
			<% end %>
		</div>
	</li>

	<li class='step trigger_params'>
		<div class='wizard-progress'><a class='back'>back</a> </div>
		<h2 class='trigger_name'>Trigger name</h2>
		<% ApplicationHelper::triggers.each do |trigger| %>
			<div class=trigger_settings data-trigger-name='<%= trigger[:name]%>'>
				<select style='float:left'>
					<%= render partial: "wizard_trigger_methods", locals: {trigger:trigger} %>
				</select>
				<%= render partial: "wizard_trigger_params", locals: {trigger:trigger} %>
			</div>
		<% end %>
		<a onclick='anotherTrigger.apply(this)'>another trigger</a> or <a onclick='toStep("action")'>set action</a>
	</li>


	<li class='step action'>
		<div class='wizard-progress'><a class='back'>back</a> </div>
		<h1>Choose Action</h1>
		<div style='font-size:20px'>
			<% ApplicationHelper::actions.each do |action| %>
				<div class=action onclick='toActionParams("<%= action[:name] %>")'><%= action[:name] %></div>
			<% end %>
		</div>
	</li>


	<li class='step action_params'>
		<div class='wizard-progress'><a class='back'>back</a> </div>
		<h1 class='action_name'>Action Parameters</h1>
		<% ApplicationHelper::actions.each do |action| %>
			<%= render partial:"wizard_action_params", locals: {action:action} %>
		<% end %>
		<a onclick='toStep("done")'>save recipe</a>
	</li>


	<li class='step done'>
		thank you, recipe saved
	</li>


	<div style='height:1000px'>
	</div>

</ul>