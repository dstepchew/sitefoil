<%= render "recipes/selector_pick" %>

<style>

#recipe_animated {}
.step {
	position: relative;
}
.step .overlay_disabled {
  position: absolute;
  width: 100%;
  height: 100%;
 	display: none;
}

.step.hidden_step .overlay_disabled {
	display: block;
}

#site option {
	font-size: 14px;
}

a {
	cursor: pointer;
}
.step {
	border-bottom: 1px solid #CCC; padding-top:70px; padding-bottom:70px;
}

.step .col-lg-10 {padding-bottom:15px;}

.wizard-progress {
	font-size: 14px;
	text-align: right;
	height: 14px;
	white-space:nowrap;
}

.trigger_select.selected {
	background: #ddd;
}

.trigger_select, .action_select {
	cursor: pointer;
}

.step {
	display:none;
	
}

ul.steps {
	list-style: none;
}

.trigger_settings {
	display: none;
}

.trigger_delete {
	position: absolute;
	margin-left: -80px;
	margin-top: 20px;
	display: none;
}

.back {
	display: none; margin-right:5px;
}

.trigger_select, .action_select { 
	cursor: pointer;
	display: inline-block;
	border: 1px solid #CCC;
	margin: 5px;
	padding: 5px 10px;
}

select, input[type=text], input[type=date], input[type=time], #recipe, #trigger_param, .action_param { 
	border:0; color:#000000; background: #fff;
	font-size:20px; font-weight:bold; padding:2px 10px; 
 *background:#FFFFFF; -webkit-appearance: none; 
 	margin: 0 5px;
}

input.action_param {
	width: 100%;
}

.step.hidden_step a {
   pointer-events: none;
   cursor: default;
}


textarea.action_param {
	width:100%;
	height: 200px;
}

.trigger_settings {
	min-height: 40px;
}

#site_url_validate {
	color: red;
}


.step.account_create .error {
	margin: 0 10px;
	color: red;
}

.help-text {
	top: 10px;
	position: relative;
	clear: both;
}

</style>

<script>

function validUrl(url) {
	return url.match(/^(?:\u0066\u0069\u006C\u0065\u003A\u002F{2}(?:\u002F{2}(?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*\u0040)?(?:\u005B(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){6}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){5}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){4}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A)?[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){3}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,3}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,4}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,5}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,6}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2})\u005D|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?\u002E)+[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?))(?:\u003A(?:\u0030-\u0035\u0030-\u0039{0,4}|\u0036\u0030-\u0034\u0030-\u0039{3}|\u0036\u0035\u0030-\u0034\u0030-\u0039{2}|\u0036\u0035\u0035\u0030-\u0032\u0030-\u0039|\u0036\u0035\u0035\u0033\u0030-\u0035))?(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*|\u002F(?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])+(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*)?|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])+(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*)|[\u0041-\u005A\u0061-\u007A][\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002B\u002D\u002E]*\u003A(?:\u002F{2}(?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*\u0040)?(?:\u005B(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){6}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){5}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){4}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A)?[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){3}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,3}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,4}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035]))|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,5}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}|(?:(?:[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4}\u003A){0,6}[\u0030-\u0039\u0041-\u0046\u0061-\u0066]{1,4})?\u003A{2})\u005D|(?:(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])\u002E){3}(?:[\u0030-\u0039]|[\u0031-\u0039][\u0030-\u0039]|\u0031[\u0030-\u0039]{2}|\u0032[\u0030-\u0034][\u0030-\u0039]|\u0032\u0035[\u0030-\u0035])|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?\u002E)+[\u0041-\u005A\u0061-\u007A\u0030-\u0039](?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D]+)?[\u0041-\u005A\u0061-\u007A\u0030-\u0039])?))(?:\u003A(?:\u0030-\u0035\u0030-\u0039{0,4}|\u0036\u0030-\u0034\u0030-\u0039{3}|\u0036\u0035\u0030-\u0034\u0030-\u0039{2}|\u0036\u0035\u0035\u0030-\u0032\u0030-\u0039|\u0036\u0035\u0035\u0033\u0030-\u0035))?(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*|\u002F(?:(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])+(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*)?|(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])+(?:\u002F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)*)(?:\u003F(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040\u002F\u003F]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)?(?:\u0023(?:[\u0041-\u005A\u0061-\u007A\u0030-\u0039\u002D\u002E\u005F\u007E\u0021\u0024\u0026\u0027\u0028\u0029\u002A\u002B\u002C\u003B\u003D\u003A\u0040\u002F\u003F]|\u0025[\u0030-\u0039\u0041-\u0046\u0061-\u0066][\u0030-\u0039\u0041-\u0046\u0061-\u0066])*)?)$/)
}

function validateSiteUrl() {
	$("#site_url_validate").html("&nbsp")
	$("#site_url").val($("#site_url").val().trim())
	var site_url = $("#site_url").val()
	if(!site_url) {
		$("#site_url_validate").html("site url can't be blank")
		$("#site_url").focus()
		return false
	}
	if( !validUrl(site_url) ) {
		if(validUrl("http://")+site_url) {
			$("#site_url").val("http://"+site_url)
			return true;
		}

		$("#site_url_validate").html("please enter valid url (example: http://somesite.com)")
		$("#site_url").focus()
		return false
	}

	return true;
}

var animation_speed = 1;

function toTriggerParams(trigger_name) {
	$(this).addClass("selected")
	toNextStep.apply(this);
	var trigger_settings = $(".step.trigger_params:last .trigger_settings[data-trigger-name='"+trigger_name+"']")
	$(".step.trigger_params:last .trigger_name").html(trigger_name)
	$(".step.trigger_params:last .trigger_settings").hide()
	trigger_settings.show()
	trigger_settings.find("#trigger_param").hide()
	trigger_settings.find(".trigger_method").val('')

	var trigger_method =	trigger_settings.find(".trigger_method")
	if(trigger_method.find("option").length==2) {
		trigger_method.val(trigger_method.find("option:last").val())
			.attr("disabled", true)
			.trigger("change")
	}
}

function toActionParams(action_name) {
	toStep("action_params");

	$(".step.action_params .action_name").html(action_name);

  $(".step.action_params .action_params").hide();
  $(".step.action_params .action_params[data-action-name='"+action_name+"']").show()
}



var trigger_count = 1;

function anotherTrigger() {
	trigger_count++;
	var cur_step = $(this).parents(".step");

	cur_step.after($(".step.trigger_params")[0].outerHTML)
	cur_step.after($(".step.trigger")[0].outerHTML)

	$(".step.trigger:last").hide().addClass("and trigger_"+trigger_count)
	$(".step.trigger_params:last").hide().addClass("and trigger_params_"+trigger_count)

	$(".step.trigger_"+trigger_count+" .trigger").attr("onclick",'toStep("trigger_params_'+trigger_count+'")')

	toStep("trigger_"+trigger_count)

	updateTriggerDeleteButtons()

}

function back() {
	var cur_step = $(this).parents(".step");
  cur_step.addClass("hidden_step").fadeOut(200*animation_speed).slideUp(200*animation_speed)
  var prev_step = cur_step.prev()
  console.log("back",prev_step)

  while(!prev_step.is(":visible")) {
  	prev_step = prev_step.prev()
  }

  activateStep(prev_step)

  //case for AND trigger
  if(cur_step.hasClass("trigger") && !cur_step.is($(".step.trigger:first")) ) {
  	cur_step.next().remove() //trigger params
  	cur_step.remove() //triger select
  }

  updateTriggerDeleteButtons()

}

function updateTriggerDeleteButtons() {

	if($(".step.trigger").length>1) {
		$(".trigger_delete").show()
	} else {
		$(".trigger_delete").hide()
	}
}


function activateStep(show_step) {
	setTimeout(function() {
		show_step.find(".back").show() //show back button in new step

		show_step.show()
			.animate({opacity: 1}, 500*animation_speed);

	  show_step.find(".selected").removeClass("selected")

	  $('html, body').animate({
	      scrollTop: show_step.offset().top
	  }, 500*animation_speed);

	  show_step.removeClass("hidden_step")
	}, 100*animation_speed)
}

function animateToNextStep(show_step) {
	console.log("animateToNextStep",show_step.attr("class"))


	$(".step").css({opacity: 0.5}).addClass("hidden_step") //hide all steps
	$(".back").hide() //hide all back buttons

	activateStep(show_step)

}

function toStep(step_name) {

	console && console.log("to step: "+step_name)
	var show_step = $(".step."+step_name)
	animateToNextStep(show_step)

}

function toNextStep(step_name) {
	var cur_step = $(this).parents(".step");
	console.log("toNextStep cur_step:",cur_step,cur_step.attr("class"))
	var next_step = cur_step.next();
	if(step_name) {
		next_step = $(".step."+step_name)
	}
	console.log("next_step:",next_step.attr("class"))
	animateToNextStep(next_step);

}
 
function onSiteSelected() {
	if($("#site").val()) {
 		toNextStep.apply(this,["trigger"])
 	}
}

function getRecipeStructure() {

	var ret = {triggers:[],action:{}};

	$(".step.trigger_params:visible").each(function() {
		ret.triggers.push({
			name: $(this).find(".trigger_name").html(),
			method: $(this).find(".trigger_settings:visible .trigger_method").val(),
			param: $(this).find(".trigger_settings:visible .trigger_param").val()
		})
	})


	ret.action.name = $(".step.action_params .action_name").html()
	ret.action.params = []
	$(".step.action_params .action_params:visible .action_param").each(function() {
		ret.action.params.push( {
			name: $(this).attr("name"),
			val: $(this).val()
		})
	})
	return ret;
}

function saveRecipe(on_success) {
	var recipe_struct = {wizard_json: JSON.stringify(getRecipeStructure()), site_id: $("#site").val()}

	console.log("SAVING RECIPE", recipe_struct);

	var params = {recipe_json: JSON.stringify(recipe_struct)}

	if($(".step.site_create").is(":visible")) {
		params.site = JSON.stringify({	
				url:$("input[name=site_url]").val(), 
				timezone_minutes: $("select[name=site_timezone_minutes]").val()
			})
	}

	if($(".step.account_create").is(":visible")) {
		params.user = JSON.stringify({
			email:$("#email").val(),
			full_name: $("#full_name").val(),
			password:$("#password").val()
		})
	}


	$(".step.account_create .error").html("");

	$.get("/api/recipe_create", params, function(resp) {
		var resp = JSON.parse(resp)
		console.log("response",resp)
		if(resp.user_error) {
			console.log('got user error')
			for(var key in resp.user_error) {
				console.log(key)
				var value = resp.user_error[key];
				$(".register_form_input#"+key).next(".error").html(value)
			}
		}	else if(resp.error) {
			alert(resp.error)
		} else {
			on_success()
		}

	})


}

$(function() {
	$(".back").addClass("btn btn-default").prepend("<i class='glyphicon glyphicon-chevron-up'></i> ")
	$(".step:first").show();
	$(".step").prepend("<div class=overlay_disabled></div>");
	var step = 1;
	var total = $(".step").length-1;
	$(".step").each(function() {
		if(step<=total) {
			$(this).find(".wizard-progress").append(" step "+step+" of "+total+" ")
			step++
		}
	})

	$(document).on("click","a.back",function() {
		back.apply(this);
	})

	$(document).on("click",".trigger_delete",function() {
		var cur_step = $(this).parents(".step");
		if(cur_step.hasClass("trigger") && !cur_step.hasClass("hidden_step")) {
			back.apply(this);
			return;
		}
		cur_step.next().slideUp(animation_speed*500).fadeOut(animation_speed*500,function() { $(this).remove(); updateTriggerDeleteButtons() })
		cur_step.slideUp(animation_speed*500).fadeOut(animation_speed*500,function() { $(this).remove(); updateTriggerDeleteButtons() })
		
	});

	var offset = new Date().getTimezoneOffset();
	offset = -offset;
	console.log('setting timezone to user browser timezone',-offset)
	$("[name=site_timezone_minutes]").val(offset);

	$(".register_form_input#password").keydown(function(e) {
		console.log(e)
		if(e.keyCode==13) {
			$("input#done.register_form_input").trigger("click")
		}
	})
	$(document).on("change",".step.trigger_params .trigger_settings .trigger_method",function() {
		var method = $(this).val()
		$(this).next().find("#trigger_param").toggle(_.str.contains(method,"?"))
	});


})

</script>

<div class="steps container" id="recipe_animated">
	<% if current_user %>
		
		<div class='step site_select row'>
		<h1 style="border-bottom:solid #ccc 1px;">Create New Recipe</h1>
				<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
			
				<select id=site onChange='onSiteSelected.apply(this)'>
					<option value=''>-- Select Your Site --</option>
					<% current_user.sites.each do |site| %>
						<option value=<%= site.id%>><%= site.name_or_url %></option>
					<% end %>
				</select>
				or <div><a onclick='toNextStep.apply(this)' class='btn btn-default ' style="margin-left:5px;margin-top:10px;"><i class="glyphicon glyphicon-plus" style="color:#333;"></i> Add New Site</a></div>
				</div>
				<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2' style="white-space:nowrap"></div>
		</div>
	<% end %>

	<div class='step site_create row'>
		<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
		
		<h1>Create New Site</h1>
		<% if !current_user %>
		<a href=/users/sign_in>already have account?</a>
		<br>
		<br>
		<% end %>
		<div style="padding-left:5px;">
		<div class="form-group">
				<label for="site_url">Url:</label> 
				<input id="site_url" name="site_url" class="form-control" placeholder="Example:http://www.sitefoil.com"><br>
				<div id="site_url_validate">&nbsp;</div>

		</div>		
		<div class="form-group">
				
				<label>Time Zone:</label> 
				
				<select class="form-control" name='site_timezone_minutes' style="margin:0px;">
		    <%= options_for_select ApplicationHelper::timezones %>
		    </select>
		</div>
		    
    
    <br>
    <br>
		<a onclick='if(validateSiteUrl()) { toNextStep.apply(this) }' class='btn btn-default'>Next <i class="glyphicon glyphicon-chevron-right"></i></a>
		* - in order for recipe to work you will have to add code snippet to your site layout
		</div></div>
		<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'>
			<% if current_user %>
				<a  class='back'>back</a>
			<% end %>
		</div>

	</div>

	<div class='step trigger row'>
		<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
		<h1 class="primary">If <b>This</b> Happens...</h1>
		<button type="button" class="btn btn-danger btn-circle trigger_delete">
    		<i class="glyphicon fa fa-trash"></i>
    </button>
		<h1>Choose Trigger</h1>
		<div style='font-size:20px'>
			<% ApplicationHelper::triggers.each do |trigger| %>
				<div class="trigger_select" onclick='toTriggerParams.apply(this,["<%= trigger[:name] %>"])'><%= trigger[:name] %></div>
			<% end %>
		</div>
		</div>
		<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'><a class='back'>back</a> </div>
	</div>

	<div class='step trigger_params row'>
		<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
		<h2 class="primary">IF</h2> <h2 class='trigger_name'>Trigger name</h2>
		<% ApplicationHelper::triggers.each do |trigger| %>
			<div class="trigger_settings row" data-trigger-name='<%= trigger[:name]%>'>
			<div class="col-md-8">
				<select style="display:inline-block;" class='trigger_method'>
					<%= render partial: "wizard_trigger_methods", locals: {trigger:trigger} %>
				</select>
				<%= render partial: "wizard_trigger_params", locals: {trigger:trigger} %>
			</div>
				<div class="col-md-4">
				<div class="help-text well">

					<i class="glyphicon glyphicon-heart primary">   </i> <span class="primary" style="margin-left:5px;">Tip:</span> <%= trigger[:help] %>
			
				</div>
				</div>

			</div>
		<% end %>
		<hr style="border-color:#CCC;">
		<h3>
		<a onclick='anotherTrigger.apply(this)' class="btn btn-default btn-warning"><i class="glyphicon glyphicon-plus"></i> Add Another Trigger (and if this happens)</a> or
		<a onclick='toNextStep.apply(this)' id="set_action" class="btn btn-default btn-success">Create Your Action <i class="glyphicon glyphicon-chevron-right"></i></a>
		</h3>
		
		</div>
		<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'><a class='back'>back</a> </div>
	</div>


	<div class='step action row'>
		
		<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
		<h1 class="primary">Then Do <b>This</b>...</h1>
		<h2>Choose Action</h2>
		<div style='font-size:20px'>
			<% ApplicationHelper::actions.each do |action| %>
				<div class="action_select" id="<%= action[:name] %>" onclick='toActionParams("<%= action[:name] %>")'><%= action[:name] %></div>
			<% end %>
		</div>
		</div>
		<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'><a class='back'>back</a> </div>
	</div>


	<div class='step action_params row'>
		<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
		<h1 class='action_name'>Action Parameters</h1>
		
		<div class="row">
		
		<% ApplicationHelper::actions.each do |action| %>
		

			<%= render partial:"wizard_action_params", locals: {action:action} %>
		


		<% end %>
		
		

		</div>



		<center>
			<h4>

			<% if !current_user %>
				<a id=save_recipe onclick='toNextStep.apply(this)' class="btn btn-default">Register and Save Recipe</a>
			<% else %>
				<a id=save_recipe onclick='var self = this; saveRecipe(function() {toNextStep.apply(self)})' class="btn btn-default btn-primary"><i class="glyphicon glyphicon-ok"> </i> Save Recipe</a>	
			<% end %>
			</h4>
		</center>
		</div>
		<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'><a class='back'>back</a> </div>
	</div>

	<% if !current_user %>
		<div class='step account_create row'>
			<div class='col-xs-12 col-sm-10 col-md-10 col-lg-10'>
			<h1>REGISTER TO COMPLETE YOUR FIRST RECIPE</h1>
				<div class="form-group">
					<label for="email">Your Email Address</label> 
					<input name="email" class="register_form_input form-control" id="email"><span class=error></span>
				
					<label for="password">Choose A Password</label> 
					<input class="register_form_input form-control" type="password" name="password" id="password"><<span class="error"></span><br>
				
				<br>
				<input type=button id=done onclick='var self = this; saveRecipe(function() {window.location="/recipes/after_user_create"})' class='btn btn-default register_form_input' value='done'>
			</div>

			<div class='wizard-progress col-xs-12 col-sm-2 col-md-2 col-lg-2'><a onclick='$("#site").val("")' class='back'>back</a></div>
		</div>
	<% end %>

	<div class='step done row'>
		<div class='wizard-progress'><a class='back'>back</a> </div>
		<span class=message>Thank you, your recipe has been saved.</span>
	</div>


	<div style='height:1000px'>
	</div>

</ul>